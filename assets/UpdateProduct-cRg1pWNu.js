import{d as M,r as V,o as P,V as L,E as n,p as N,i as f,b as s,e as a,w as r,z as R,A as S,B as $,C as z,a2 as H,g as T,u as b,a3 as A,v as u,q as J,k as w,F as Q,J as X,y as j,Q as G,m as _,R as K,_ as O}from"./index-W1bgIC_N.js";/* empty css                  *//* empty css                     *//* empty css                    *//* empty css                 */import{a as W,c as Y}from"./product-C5mZKjkp.js";import{u as Z}from"./tool-C-2oWe-p.js";import"./request-C-7Hg0qh.js";const ee={class:"update-page"},te={class:"update-container"},ae={key:0,class:"el-upload__tip"},le=["href"],oe={class:"specifications-container"},ie={class:"button-group"},re=M({__name:"UpdateProduct",setup(de){const h=L(),p=V(!1),t=V({id:"",title:"",price:0,rate:0,description:"",cover:"",specifications:[]}),g=V([]);P(async()=>{try{const o=h.params.id,e=await W(o);if(e.data.code==="200"){const l=e.data.data;t.value={id:l.id,title:l.title,price:l.price,rate:l.rate,description:l.description,cover:l.cover,specifications:l.specifications||[]},l.cover&&(g.value=[{name:"商品封面",url:l.cover}])}}catch{n.error("获取商品信息失败")}});const x=N(()=>{var o;return!((o=t.value.title)!=null&&o.trim()&&t.value.price!==void 0&&t.value.rate!==void 0&&t.value.rate>=0&&t.value.rate<=10)}),U=()=>{var o;(o=t.value.specifications)==null||o.push({item:"",value:""})},k=o=>{var e;(e=t.value.specifications)==null||e.splice(o,1)},C=o=>{new FormData().append("file",o.raw),Z().then(l=>{t.value.cover=l.data.data.url,n.success("图片上传成功")}).catch(()=>{n.error("图片上传失败")})},E=()=>{n.warning("最多只能上传一张图片")},q=()=>new XMLHttpRequest,F=async()=>{var o;p.value=!0;try{const e=(o=t.value.specifications)==null?void 0:o.filter(c=>c.item.trim()&&c.value.trim()),l={...t.value,specifications:e},d=await Y(l);d.data.code==="200"?(n.success("商品更新成功"),setTimeout(()=>{window.location.href=`/products/${t.value.id}`},1500)):n.error(d.data.msg||"更新失败")}catch{n.error("请求失败，请检查网络")}finally{p.value=!1}};return(o,e)=>{const l=z,d=$,c=T,I=H,m=j,B=S,D=R;return _(),f("div",ee,[s("div",te,[a(D,{class:"form-card"},{default:r(()=>[s("div",null,[e[10]||(e[10]=s("h1",null,"编辑商品",-1)),a(B,{"label-position":"right","label-width":"100px",size:"large",class:"update-form"},{default:r(()=>[a(d,{label:"商品名称",required:""},{default:r(()=>[a(l,{id:"title",modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value.title=i),required:"",placeholder:"请输入商品名"},null,8,["modelValue"])]),_:1}),a(d,{label:"商品价格",required:""},{default:r(()=>[a(l,{id:"price",modelValue:t.value.price,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.price=i),required:"",placeholder:"请输入商品价格",type:"number"},null,8,["modelValue"])]),_:1}),a(d,{label:"商品评分",required:""},{default:r(()=>[a(l,{id:"rate",modelValue:t.value.rate,"onUpdate:modelValue":e[2]||(e[2]=i=>t.value.rate=i),modelModifiers:{number:!0},required:"",placeholder:"请输入评分（0-10）",type:"number",step:"0.1",min:"0",max:"10"},null,8,["modelValue"])]),_:1}),a(d,{label:"商品描述"},{default:r(()=>[a(l,{id:"description",modelValue:t.value.description,"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.description=i),placeholder:"商品描述",type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),a(d,{label:"商品封面"},{default:r(()=>[a(I,{"file-list":g.value,"onUpdate:fileList":e[4]||(e[4]=i=>g.value=i),limit:1,"on-change":C,"on-exceed":E,class:"upload-demo","list-type":"picture","http-request":q,drag:""},{tip:r(()=>[t.value.cover?(_(),f("div",ae,[e[6]||(e[6]=u(" 当前封面：")),s("a",{href:t.value.cover,target:"_blank"},w(t.value.cover),9,le)])):J("",!0)]),default:r(()=>[a(c,{class:"el-icon--upload"},{default:r(()=>[a(b(A))]),_:1}),e[7]||(e[7]=s("div",{class:"el-upload__text"},[u(" 将文件拖到此处或"),s("em",null,"单击此处"),u("上传。仅允许上传一份文件。 ")],-1))]),_:1},8,["file-list"])]),_:1}),a(d,{label:"商品规格"},{default:r(()=>[s("div",oe,[(_(!0),f(Q,null,X(t.value.specifications,(i,y)=>(_(),f("div",{key:y,class:"spec-item"},[a(l,{modelValue:i.item,"onUpdate:modelValue":v=>i.item=v,placeholder:"规格名称",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),a(l,{modelValue:i.value,"onUpdate:modelValue":v=>i.value=v,placeholder:"规格值",style:{width:"200px","margin-right":"10px"}},null,8,["modelValue","onUpdate:modelValue"]),a(m,{type:"danger",circle:"",icon:b(K),onClick:v=>k(y)},null,8,["icon","onClick"])]))),128)),a(m,{type:"primary",onClick:U,style:{"margin-top":"10px"}},{default:r(()=>e[8]||(e[8]=[u(" 添加规格 ")])),_:1})])]),_:1}),s("span",ie,[a(m,{type:"primary",onClick:G(F,["prevent"]),disabled:x.value,loading:p.value},{default:r(()=>[u(w(p.value?"提交中...":"更新商品"),1)]),_:1},8,["disabled","loading"]),a(m,{onClick:e[5]||(e[5]=i=>o.$router.go(-1))},{default:r(()=>e[9]||(e[9]=[u(" 返回 ")])),_:1})])]),_:1})])]),_:1})])])}}}),_e=O(re,[["__scopeId","data-v-2d4945ad"]]);export{_e as default};

import{d as ce,r as m,p as L,o as me,i as u,b as a,e as n,w as r,z as ve,V as pe,E as i,K as _e,L as fe,q as v,c as F,y as ge,v as c,N as ye,k as f,T as ke,W as be,X as he,F as H,J as N,U as Ve,Y as we,A as Ce,B as Ee,C as Fe,H as Y,m as d,Z as Ae,$ as Be,a0 as De,a1 as xe,_ as Ie}from"./index-W1bgIC_N.js";/* empty css                   *//* empty css                  *//* empty css                       *//* empty css                     *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                        */import{a as Te,b as Me,u as Ue}from"./product-C5mZKjkp.js";import{a as $e}from"./cart-D0JSwHAf.js";import{s as T,A as M}from"./request-C-7Hg0qh.js";const I=k=>T.get(`${M}/${k}`).then(p=>p),qe=k=>T.post(`${M}`,k).then(p=>p),Pe=k=>T.delete(`${M}/${k}`).then(p=>p),Re={class:"product-detail-page"},Se={class:"detail-container"},Le={class:"back-button"},He={key:0},Ne={class:"detail-content"},Ye={class:"detail-image"},ze={class:"detail-info"},Oe={class:"product-header"},Xe={class:"product-title"},je={class:"price-section"},Je={class:"price"},Ke={key:0,class:"cart-section"},We={class:"quantity-selector"},Ze={class:"stock-info"},Ge={class:"detail-header"},Qe={key:0,class:"action-buttons"},et={class:"bottom-section"},tt={key:0,class:"product-description"},at=["innerHTML"],st={key:1,class:"product-description"},ot=["innerHTML"],lt={key:2,class:"product-specs"},nt={class:"comment-section"},rt={class:"comment-header"},it={class:"section-title"},dt={key:0,class:"comment-list"},ut={class:"comment-inner"},ct={class:"comment-details"},mt={class:"user-header"},vt={class:"username"},pt={class:"create-time"},_t={class:"rate-container"},ft={class:"comment-content"},gt={class:"comment-actions"},yt={class:"dialog-footer"},kt=ce({__name:"ProductDetail",setup(k){const p=pe(),b=m(!0),o=m(null),z=L(()=>sessionStorage.getItem("username")||""),O=()=>{Y.push({path:"/create_ad",query:{productId:o.value.id}})},g=m([]),X=t=>De(t).format("YYYY-MM-DD HH:mm"),h=m(!1),_=m({rating:0,content:""}),U=m(),B=m(!1),j={rating:[{required:!0,validator:(t,e,l)=>{e<=0?l(new Error("è¯·é€‰æ‹©è¯„åˆ†")):l()},trigger:"change"}],content:[{required:!0,message:"è¯·è¾“å…¥è¯„è®ºå†…å®¹",trigger:"blur"},{min:1,message:"è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º",trigger:"blur"},{validator:(t,e,l)=>{!e||!e.trim()||!/\S/.test(e)?l(new Error("è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©ºæˆ–å…¨æ˜¯ç©ºæ ¼")):l()},trigger:["blur","change"]}]},J=()=>{_.value={rating:0,content:""},h.value=!0},K=async()=>{B.value=!0;try{await U.value.validate();const t={productId:o.value.id,rating:_.value.rating,content:_.value.content},e=await qe(t);if(e.data.code==="200"){i.success("è¯„è®ºæäº¤æˆåŠŸï¼");const l=await I(o.value.id);g.value=l.data.data,h.value=!1}else i.error(e.data.msg||"è¯„è®ºæäº¤å¤±è´¥")}catch(t){t instanceof Error?i.error("éªŒè¯å¤±è´¥ï¼š"+t.message):i.error("è¯„è®ºæäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{B.value=!1}},W=async t=>{try{if(await xe.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ","åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"})){const l=await Pe(t);if(l.data.code==="200"){i.success("è¯„è®ºåˆ é™¤æˆåŠŸ");const D=await I(o.value.id);g.value=D.data.data}else i.error(l.data.msg||"åˆ é™¤å¤±è´¥")}}catch(e){e!=="cancel"&&i.error("åˆ é™¤è¯„è®ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}},Z=t=>{console.log(t)},y=m(1),G=async()=>{try{if(y.value>V.value){i.warning("åº“å­˜ä¸è¶³");return}const t=await $e({productId:o.value.id,quantity:y.value});t.data.code==="200"?(i.success({message:"æˆåŠŸåŠ å…¥è´­ç‰©è½¦",duration:1e3,showClose:!0}),y.value=1):i.error(t.data.msg||"æ·»åŠ è´­ç‰©è½¦å¤±è´¥")}catch(t){i.error("ç½‘ç»œè¯·æ±‚å¤±è´¥"),console.error("æ·»åŠ è´­ç‰©è½¦é”™è¯¯:",t)}},V=m(0),w=m(!1),C=m(0),E=L(()=>sessionStorage.getItem("role")||""),Q=()=>{C.value=o.value.stock,w.value=!0},ee=async()=>{var t;try{const e=await Ue({id:o.value.id,amount:C.value});e.data.code==="200"?(i.success("åº“å­˜æ›´æ–°æˆåŠŸ"),V.value=C.value,w.value=!1):i.error(e.data.msg||"åº“å­˜æ›´æ–°å¤±è´¥")}catch(e){e.response?i.error(`æœåŠ¡å™¨é”™è¯¯: ${((t=e.response.data)==null?void 0:t.message)||e.message}`):e.request?i.error("ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"):i.error("è¯·æ±‚é…ç½®é”™è¯¯")}},te=()=>{Y.push({name:"UpdateProduct",params:{id:o.value.id}})},ae=t=>t?t.toFixed(2):"0.00",se=async()=>{try{b.value=!0;const t=await Te(p.params.id),e=await Me(p.params.id);t.data.code==="200"?o.value=t.data.data:i.error(t.data.msg||"è·å–å•†å“è¯¦æƒ…å¤±è´¥"),e.data.code==="200"?V.value=e.data.data.amount:i.error(t.data.msg||"è·å–åº“å­˜å¤±è´¥");const l=await I(o.value.id);l.data.code==="200"&&(g.value=l.data.data)}catch{i.error("ç½‘ç»œè¯·æ±‚å¤±è´¥")}finally{b.value=!1}};return me(()=>{se()}),(t,e)=>{const l=ge,D=ye,x=ke,oe=be,le=Ae,ne=he,re=Be,$=Ve,q=Ee,P=Fe,ie=Ce,R=we,de=ve,ue=fe;return d(),u("div",Re,[a("div",Se,[n(de,{class:"detail-card"},{default:r(()=>{var S;return[_e((d(),u("div",null,[a("div",Le,[n(l,{onClick:e[0]||(e[0]=s=>t.$router.go(-1)),type:"primary",plain:""},{default:r(()=>e[10]||(e[10]=[c(" è¿”å›åˆ—è¡¨ ")])),_:1})]),o.value?(d(),u("div",He,[a("div",Ne,[a("div",Ye,[n(D,{src:o.value.cover,fit:"contain",class:"image"},null,8,["src"])]),a("div",ze,[a("div",Oe,[a("h1",Xe,f(o.value.title),1),n(x,{modelValue:o.value.rate,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.rate=s),disabled:"",max:10,colors:["#99A9BF","#F7BA2A","#FF9900"],class:"product-rating"},null,8,["modelValue"])]),a("div",je,[a("span",Je,"Â¥"+f(ae(o.value.price)),1)]),E.value==="user"?(d(),u("div",Ke,[a("div",We,[e[11]||(e[11]=a("span",{class:"quantity-label"},"è´­ä¹°æ•°é‡ï¼š",-1)),n(oe,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s),min:1,size:"default",precision:0,onChange:Z},null,8,["modelValue"]),a("span",Ze,"åº“å­˜ "+f(V.value)+" ä»¶",1)]),n(l,{type:"danger",class:"add-cart-btn",onClick:G,disabled:y.value>V.value||y.value<1},{default:r(()=>e[12]||(e[12]=[c(" ğŸ›’ åŠ å…¥è´­ç‰©è½¦ ")])),_:1},8,["disabled"])])):v("",!0),a("div",Ge,[E.value==="admin"?(d(),u("div",Qe,[n(l,{type:"primary",onClick:te,class:"edit-btn"},{default:r(()=>e[13]||(e[13]=[c(" ç¼–è¾‘å•†å“ ")])),_:1}),n(l,{type:"success",onClick:Q},{default:r(()=>e[14]||(e[14]=[c(" æ›´æ–°åº“å­˜ ")])),_:1}),n(l,{type:"warning",onClick:O},{default:r(()=>e[15]||(e[15]=[c(" åˆ›å»ºå¹¿å‘Š ")])),_:1})])):v("",!0)])])]),a("div",et,[o.value.description&&o.value.description.trim()?(d(),u("div",tt,[e[16]||(e[16]=a("h3",{class:"section-title"},"å•†å“ç®€ä»‹",-1)),a("div",{innerHTML:o.value.description,class:"description-content"},null,8,at)])):v("",!0),o.value.detail&&o.value.detail.trim()?(d(),u("div",st,[e[17]||(e[17]=a("h3",{class:"section-title"},"å•†å“è¯¦æƒ…",-1)),a("div",{innerHTML:o.value.detail,class:"description-content"},null,8,ot)])):v("",!0),(S=o.value.specifications)!=null&&S.length?(d(),u("div",lt,[e[18]||(e[18]=a("h3",{class:"section-title"},"å•†å“è§„æ ¼",-1)),n(ne,{border:""},{default:r(()=>[(d(!0),u(H,null,N(o.value.specifications,(s,A)=>(d(),F(le,{key:A,label:s.item},{default:r(()=>[c(f(s.value),1)]),_:2},1032,["label"]))),128))]),_:1})])):v("",!0),a("div",nt,[a("div",rt,[a("h3",it,"ç”¨æˆ·è¯„ä»·ï¼ˆ"+f(g.value.length)+"æ¡ï¼‰",1),E.value==="user"?(d(),F(l,{key:0,type:"primary",class:"add-comment-btn",onClick:J},{default:r(()=>e[19]||(e[19]=[c(" âœï¸ æ·»åŠ ä¹¦è¯„ ")])),_:1})):v("",!0)]),g.value.length>0?(d(),u("div",dt,[(d(!0),u(H,null,N(g.value,s=>(d(),u("div",{key:s.id,class:"comment-item"},[a("div",ut,[n(re,{src:s.avatar,class:"user-avatar"},null,8,["src"]),a("div",ct,[a("div",mt,[a("span",vt,f(s.username),1),a("span",pt,f(X(s.createTime)),1)]),a("div",_t,[n(x,{modelValue:s.rating,"onUpdate:modelValue":A=>s.rating=A,disabled:"",max:5,"allow-half":"",colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue","onUpdate:modelValue"])]),a("div",ft,f(s.content),1),a("div",gt,[E.value==="admin"||E.value==="user"&&s.username===z.value?(d(),F(l,{key:0,type:"danger",size:"small",onClick:A=>W(s.id),class:"delete-btn"},{default:r(()=>e[20]||(e[20]=[c(" åˆ é™¤ ")])),_:2},1032,["onClick"])):v("",!0)])])])]))),128))])):v("",!0)]),!b.value&&g.value.length===0?(d(),F($,{key:3,description:"æš‚æ— ç”¨æˆ·è¯„ä»·ï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€ä¸ªè¯„è®ºå§ï½",class:"empty-comments"})):v("",!0)])])):v("",!0),n(R,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=s=>h.value=s),title:"å‘è¡¨ä¹¦è¯„",width:"600px","align-center":"",center:""},{footer:r(()=>[n(l,{onClick:e[5]||(e[5]=s=>h.value=!1)},{default:r(()=>e[21]||(e[21]=[c("å– æ¶ˆ")])),_:1}),n(l,{type:"primary",onClick:K,loading:B.value},{default:r(()=>e[22]||(e[22]=[c(" æäº¤è¯„è®º ")])),_:1},8,["loading"])]),default:r(()=>[n(ie,{model:_.value,rules:j,ref_key:"commentFormRef",ref:U,"label-position":"left",class:"comment-form"},{default:r(()=>[n(q,{label:"è¯„åˆ†ï¼š",prop:"rating",class:"form-item"},{default:r(()=>[n(x,{modelValue:_.value.rating,"onUpdate:modelValue":e[3]||(e[3]=s=>_.value.rating=s),max:5,"allow-half":"","show-score":"",colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue"])]),_:1}),n(q,{label:"è¯„è®ºå†…å®¹ï¼š",prop:"content",class:"form-item"},{default:r(()=>[n(P,{modelValue:_.value.content,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value.content=s),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥æ‚¨çš„è¯„ä»·",maxlength:"500","show-word-limit":"",class:"wide-textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),n(R,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=s=>w.value=s),title:"æ›´æ–°åº“å­˜",width:"30%","align-center":""},{footer:r(()=>[a("span",yt,[n(l,{onClick:e[8]||(e[8]=s=>w.value=!1)},{default:r(()=>e[23]||(e[23]=[c("å–æ¶ˆ")])),_:1}),n(l,{type:"primary",onClick:ee},{default:r(()=>e[24]||(e[24]=[c(" ç¡®è®¤ ")])),_:1})])]),default:r(()=>[n(P,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=s=>C.value=s),modelModifiers:{number:!0},type:"number",placeholder:"è¯·è¾“å…¥åº“å­˜æ•°é‡",min:"0"},null,8,["modelValue"])]),_:1},8,["modelValue"]),!b.value&&!o.value?(d(),F($,{key:1,description:"æ‰¾ä¸åˆ°è¯¥å•†å“ä¿¡æ¯"})):v("",!0)])),[[ue,b.value]])]}),_:1})])])}}}),Mt=Ie(kt,[["__scopeId","data-v-fae49ff1"]]);export{Mt as default};

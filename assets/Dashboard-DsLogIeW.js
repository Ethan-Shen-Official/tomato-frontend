import{d as Y,r as p,p as R,o as h,E as _,i as r,b as e,F as B,k as v,q as C,v as u,u as N,e as a,w as s,x as ll,g as el,y as al,z as ol,A as tl,f as sl,m as i,n as T,a as nl,B as ul,C as dl,D as rl,G as il,H as A,_ as vl}from"./index-W1bgIC_N.js";/* empty css                     *//* empty css                 *//* empty css                  *//* empty css               */import{g as S,u as ml}from"./user--Bkct1y1.js";import{p as pl}from"./index-DKFuHmXp.js";import"./request-C-7Hg0qh.js";const fl={class:"dashboard-container"},wl={class:"sidecard"},gl={class:"user-profile"},yl={class:"avatar-container"},kl=["src"],bl={class:"user-info"},Vl={key:0},_l={key:1},Pl={key:2},cl={class:"action-buttons"},Cl={key:1,class:"not-logged-in"},Ul={class:"content-area"},xl={key:0,class:"welcome-panel"},Il={class:"login-benefits"},El={key:0,class:"welcome-panel"},Rl={class:"feature-cards"},$l={class:"button-area"},Fl={key:1,class:"form-panel"},Ll={class:"form-tip"},Dl={key:0},Tl={key:1,class:"error"},zl={key:2},Bl={class:"form-tip"},Nl={key:0},Al={key:1,class:"error"},Sl={key:2},Ml={class:"form-tip"},Zl={class:"form-tip"},Hl=Y({__name:"Dashboard",setup(ql){const U=p(!0);function M(){sessionStorage.getItem("token")||(U.value=!1)}const w=sessionStorage.getItem("username"),g=p(""),x=p(""),y=p(""),k=p(""),b=p(""),P=p(""),Z=/^1\d{10}$/,H=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,I=R(()=>o.value.tele!==""),E=R(()=>o.value.email!==""),$=R(()=>I.value?Z.test(o.value.tele):!0),F=R(()=>E.value?H.test(o.value.email):!0),V=p("profile"),o=p({name:"",tele:"",email:"",location:"",avatar:"",oldPassword:"",newPassword:"",confirmPassword:""}),c=p(!0),z=()=>{A.push("/login")},q=()=>{A.push("/register")};h(async()=>{try{M(),U.value===!0&&(G(),o.value={name:g.value,tele:y.value,email:b.value,location:k.value,avatar:P.value,oldPassword:"",newPassword:"",confirmPassword:""})}catch(t){console.error("获取用户信息失败",t),_.error("连接失败")}});function G(){S(w||"").then(t=>{t.data.code==="200"?(g.value=t.data.data.name,y.value=t.data.data.tele,b.value=t.data.data.email,k.value=t.data.data.location,P.value=t.data.data.avatar,x.value=t.data.data.role):t.data.code==="400"&&_.error(t.data.msg)})}const j=async()=>{if(o.value.newPassword&&o.value.newPassword!==o.value.confirmPassword){c.value=!1,_.error("两次输入的密码不一致");return}c.value=!0;try{const t={username:w||"",role:x||"USER",name:o.value.name||g.value,telephone:o.value.tele||y.value,email:o.value.email||b.value,location:o.value.location||k.value,avatar:o.value.avatar||P.value,password:o.value.newPassword||"123456"};t.name===g.value&&t.telephone===y.value&&t.email===b.value&&t.location===k.value&&t.avatar===P.value&&t.password,ml({username:w||"",name:t.name,role:x.value,telephone:t.telephone,email:t.email,location:t.location,avatar:t.avatar,password:t.password}).then(l=>{l.data.code==="200"?(_({message:l.data.msg,type:"success",center:!0}),S(w||"").then(d=>{d.data.code==="200"?(g.value=d.data.data.name,y.value=d.data.data.tele,b.value=d.data.data.email,k.value=d.data.data.location,P.value=d.data.data.avatar,o.value.oldPassword="",o.value.newPassword="",o.value.confirmPassword=""):d.data.code==="400"&&_.error(d.data.msg)}),V.value="profile"):l.data.code==="400"&&_({message:l.data.msg,type:"error",center:!0})})}catch(t){console.error("更新用户信息失败",t),_.error("更新用户信息失败")}},J=t=>pl(t);return(t,l)=>{const d=al,K=ll,O=sl("UserFilled"),Q=el,L=nl,D=ol,f=dl,m=ul,W=il,X=tl;return i(),r("div",fl,[e("div",wl,[U.value?(i(),r(B,{key:0},[e("div",gl,[e("div",yl,[e("img",{src:P.value,alt:"用户头像",class:"user-avatar"},null,8,kl)]),e("h2",null,v(g.value),1),e("div",bl,[e("p",null,[l[15]||(l[15]=e("strong",null,"用户名:",-1)),u(" "+v(N(w)),1)]),e("p",null,[l[16]||(l[16]=e("strong",null,"身份:",-1)),u(" "+v(J(x.value||"")),1)]),b.value?(i(),r("p",Vl,[l[17]||(l[17]=e("strong",null,"邮箱:",-1)),u(" "+v(b.value),1)])):C("",!0),y.value?(i(),r("p",_l,[l[18]||(l[18]=e("strong",null,"电话:",-1)),u(" "+v(y.value),1)])):C("",!0),k.value?(i(),r("p",Pl,[l[19]||(l[19]=e("strong",null,"地址:",-1)),u(" "+v(k.value),1)])):C("",!0)])]),e("div",cl,[a(K,null,{default:s(()=>[a(d,{type:"primary",onClick:l[0]||(l[0]=n=>V.value="updateInfo"),class:T({active:V.value==="updateInfo"})},{default:s(()=>l[20]||(l[20]=[u(" 更新个人信息 ")])),_:1},8,["class"])]),_:1})])],64)):(i(),r("div",Cl,[a(Q,{class:"login-icon"},{default:s(()=>[a(O)]),_:1}),l[23]||(l[23]=e("h2",null,"未登录",-1)),l[24]||(l[24]=e("p",null,"请登录后查看个人信息",-1)),a(d,{type:"primary",onClick:z,class:"login-button"},{default:s(()=>l[21]||(l[21]=[u(" 前往登录 ")])),_:1}),a(d,{type:"success",onClick:l[1]||(l[1]=n=>t.$router.push("/all")),style:{"margin-top":"10px"}},{default:s(()=>l[22]||(l[22]=[u(" 查看全部商品 ")])),_:1})]))]),e("div",Ul,[U.value?(i(),r(B,{key:1},[V.value==="profile"?(i(),r("div",El,[e("h1",null,"欢迎回来，"+v(g.value)+"！",1),l[38]||(l[38]=e("p",null,"您可以在左侧选择操作来更新您的个人信息。",-1)),e("div",Rl,[a(D,{class:"box-card"},{default:s(()=>[a(L,{class:"card-header"},{default:s(()=>l[34]||(l[34]=[e("span",null,"账户管理",-1)])),_:1}),l[37]||(l[37]=e("ul",{class:"text-item"},[e("li",null,"您可以更新您的基本信息，如姓名、电话、邮箱等。"),e("li",null,"定期更改您的密码可以提高账户安全性。")],-1)),e("div",$l,[a(d,{type:"primary",plain:"",onClick:l[2]||(l[2]=n=>V.value="updateInfo")},{default:s(()=>l[35]||(l[35]=[u(" 更新个人信息 ")])),_:1}),a(d,{type:"success",onClick:l[3]||(l[3]=n=>t.$router.push("/all")),style:{"margin-top":"10px"}},{default:s(()=>l[36]||(l[36]=[u(" 查看全部商品 ")])),_:1})])]),_:1})])])):C("",!0),V.value==="updateInfo"?(i(),r("div",Fl,[l[47]||(l[47]=e("h2",null,"个人信息管理",-1)),a(X,{"label-position":"top"},{default:s(()=>[l[44]||(l[44]=e("h3",null,"基本信息",-1)),a(m,{label:"用户名"},{default:s(()=>[a(f,{modelValue:N(w),"onUpdate:modelValue":l[4]||(l[4]=n=>rl(w)?w.value=n:null),disabled:""},null,8,["modelValue"]),l[39]||(l[39]=e("div",{class:"form-tip"},"用户名不可更改",-1))]),_:1}),a(m,{label:"姓名"},{default:s(()=>[a(f,{modelValue:o.value.name,"onUpdate:modelValue":l[5]||(l[5]=n=>o.value.name=n),placeholder:"请输入您的真实姓名"},null,8,["modelValue"]),e("div",Ll,"不填写则保持当前值: "+v(g.value),1)]),_:1}),a(m,{label:"电话号码"},{default:s(()=>[I.value?$.value?(i(),r("label",zl,"电话号码")):(i(),r("label",Tl,"电话号码不合法（请输入1开头的11位数字）")):(i(),r("label",Dl,"电话号码")),a(f,{modelValue:o.value.tele,"onUpdate:modelValue":l[6]||(l[6]=n=>o.value.tele=n),class:T({"error-input":I.value&&!$.value}),placeholder:"请输入您的电话号码"},null,8,["modelValue","class"]),e("div",Bl,"不填写则保持当前值: "+v(y.value||"暂无"),1)]),_:1}),a(m,{label:"邮箱"},{default:s(()=>[E.value?F.value?(i(),r("label",Sl,"邮箱")):(i(),r("label",Al,"邮箱格式不正确")):(i(),r("label",Nl,"邮箱")),a(f,{modelValue:o.value.email,"onUpdate:modelValue":l[7]||(l[7]=n=>o.value.email=n),class:T({"error-input":E.value&&!F.value}),placeholder:"请输入您的邮箱地址"},null,8,["modelValue","class"]),e("div",Ml,"不填写则保持当前值: "+v(b.value||"暂无"),1)]),_:1}),a(m,{label:"地址"},{default:s(()=>[a(f,{modelValue:o.value.location,"onUpdate:modelValue":l[8]||(l[8]=n=>o.value.location=n),placeholder:"请输入您的地址"},null,8,["modelValue"]),e("div",Zl,"不填写则保持当前值: "+v(k.value||"暂无"),1)]),_:1}),a(m,{label:"头像URL"},{default:s(()=>[a(f,{modelValue:o.value.avatar,"onUpdate:modelValue":l[9]||(l[9]=n=>o.value.avatar=n),placeholder:"请输入头像图片URL"},null,8,["modelValue"]),l[40]||(l[40]=e("div",{class:"form-tip"},"不填写则保持当前头像",-1))]),_:1}),a(W,null,{default:s(()=>l[41]||(l[41]=[u("密码管理")])),_:1}),l[45]||(l[45]=e("h3",null,"修改密码 (可选)",-1)),l[46]||(l[46]=e("div",{class:"form-tip password-tip"},"修改密码，如不想修改请填写原本密码，不得留空",-1)),a(m,{label:"当前密码"},{default:s(()=>[a(f,{modelValue:o.value.oldPassword,"onUpdate:modelValue":l[10]||(l[10]=n=>o.value.oldPassword=n),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),a(m,{label:"新密码"},{default:s(()=>[a(f,{modelValue:o.value.newPassword,"onUpdate:modelValue":l[11]||(l[11]=n=>o.value.newPassword=n),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(m,{label:"确认新密码",error:c.value?"":"两次输入的密码不一致"},{default:s(()=>[a(f,{modelValue:o.value.confirmPassword,"onUpdate:modelValue":l[12]||(l[12]=n=>o.value.confirmPassword=n),type:"password",placeholder:"请再次输入新密码","show-password":"",onInput:l[13]||(l[13]=n=>c.value=o.value.newPassword===o.value.confirmPassword)},null,8,["modelValue"])]),_:1},8,["error"]),a(m,null,{default:s(()=>[a(d,{type:"primary",onClick:j,disabled:!!(I.value&&!$.value||E.value&&!F.value||o.value.newPassword&&!c.value)},{default:s(()=>l[42]||(l[42]=[u(" 保存更改 ")])),_:1},8,["disabled"]),a(d,{onClick:l[14]||(l[14]=n=>V.value="profile")},{default:s(()=>l[43]||(l[43]=[u("取消")])),_:1})]),_:1})]),_:1})])):C("",!0)],64)):(i(),r("div",xl,[l[32]||(l[32]=e("h1",null,"欢迎来到TomaTo书城",-1)),l[33]||(l[33]=e("p",null,"登录后可以享受更多功能和个性化服务",-1)),e("div",Il,[a(D,{class:"box-card"},{default:s(()=>[a(L,{class:"card-header"},{default:s(()=>l[25]||(l[25]=[e("span",null,"会员特权",-1)])),_:1}),l[26]||(l[26]=e("div",{class:"text-item"},[e("ul",null,[e("li",null,"购买中意的图书"),e("li",null,"查看订单状态"),e("li",null,"查看购物车"),e("li",null,"更多个性化推荐")])],-1))]),_:1}),a(D,{class:"box-card"},{default:s(()=>[a(L,{class:"card-header"},{default:s(()=>l[27]||(l[27]=[e("span",null,"快速登录",-1)])),_:1}),e("ul",{class:"text-item"},[e("li",null,[l[28]||(l[28]=u(" 请 ")),e("span",{class:"text-link",onClick:z},"登录"),l[29]||(l[29]=u(" 以享受更多功能 "))]),e("li",null,[l[30]||(l[30]=u(" 如果您还没有账号，可以点击此处 ")),e("span",{class:"text-link",onClick:q},"注册"),l[31]||(l[31]=u(" 新账户。 "))])])]),_:1})])]))])])}}}),Yl=vl(Hl,[["__scopeId","data-v-f3787494"]]);export{Yl as default};
